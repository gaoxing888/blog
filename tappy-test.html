<html>
<head>
	<title>tappy test</title>
	<meta name="viewport" content="width=device-width">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	
	<script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
	<script type="text/javascript">

		/*! Tappy! - a lightweight normalized tap event. Copyright 2013 @scottjehl, Filament Group, Inc. Licensed MIT */
		(function( w, $, undefined ){

			var tap = function( $els ){
				return $els.each(function(){

					var $el = $( this ),
						lastE,
						resetTimer,
						lastScroll,
						scrollTolerance = 15;

					function trigger( e ){
						//e.stopImmediatePropagation();
						e.preventDefault();
						$( e.target ).trigger( "tap", [ e, $( e.target ).attr( "href" ) ] );
					}

					function start( e ){
						lastScroll = w.document.body.scrollTop;
					}

					function end( e ){

						if( e.ctrlKey || e.metaKey ){
							return;
						}

						e.preventDefault();

						// this part prevents a double callback from touch and mouse on the same tap
						if( lastE && lastE !== e.type ){
							return false;
						}

						lastE = e.type;
						clearTimeout( resetTimer );
						resetTimer = setTimeout( function(){
							lastE = null;
						}, 1000 );

						// if a scroll happened between touchstart and touchend
						if( e.type === "touchend" && Math.abs( w.document.body.scrollTop - lastScroll ) > scrollTolerance ){
							return false;
						}

						trigger( e );
					}

					$el
						.bind( "touchstart", start )
						.bind( "touchend", end )
						.bind( "click", end );
				});
			};

			// monkeybind
			var oldBind = $.fn.bind;
			$.fn.bind = function( evt, callback ){
				if( /(^| )tap( |$)/.test( evt ) ){
					tap( this );
				}
				return oldBind.apply( this, [evt, callback] );
			};

		}( this, jQuery ));

	</script>
	<style type="text/css">
		li{margin:100px;}
		.box{border:1px solid #000;background:#000;width:50px;height:50px;float:left;margin-left:50px;}
	</style>
</head>
<body>
	<p><strong>请打开 Emulate touch screen 调试</strong></p>
	<p>页面click事件快速响应，取消300毫秒延迟</p>
	<p><a href="https://github.com/filamentgroup/tappy/blob/master/tappy.js">https://github.com/filamentgroup/tappy/blob/master/tappy.js</a></p>
	<dl>

	</dl>
	<dl>
		<dt>可能存在的问题</dt>
		<dd>在 tap 之后绑定的 touchstart, touchend, click 不会生效，必须前置</dd>
		<dd>滚动条在最上面，页面向下拉会触发 tap 事件，期望效果是不触发 tap 事件，BUG可能是 body.scrollTop 判断失误</dd>
	</dl>

	<a href="#" id="clicka"> click 事件 </a>
	<div>
		<div class="box">divTest</div>
		<div class="box">divTest</div>
	</div>
	<div id="links">
		<ul>

			<li><a href="http://www.baidu.com" > baidu.com </a></li>
			<li><a href="http://www.sina.com" > sina.com </a></li>
			<li><a href="http://www.taobao.com" > taobao.com </a></li>
			<li><a href="http://www.alipay.com" > alipay.com </a></li>

		</ul>
	</div>
	<script type="text/javascript">
		var time = 0;
		/**
		$('a').bind('click', function(){
			alert("click")
		});
		*/
		var time = 0;
		$('#clicka').bind("touchend", function(){
			time = new Date().getTime();
		}).bind("click", function(){
			alert("event click, 响应时间"+ (new Date().getTime()-time)+"毫秒");
		});


		$('#links a').bind("tap", function(){
			alert( "tap,"+ (new Date().getTime()-time) );
			
		}).bind("touchend", function(){
			console.log("touchend");
			time = new Date().getTime();
		});

		$('.box').bind("touchend", function(){
			time = new Date().getTime();
		}).bind("tap", function(){

			
			//var element = $(this);
			alert( "event tap,响应时间 "+ (new Date().getTime()-time) +"毫秒" );
			//alert( element.attr("href") )

		});

	function trigger( e ){
		//e.stopImmediatePropagation();
		e.preventDefault();
		$( e.target ).trigger( "tap", [ e, $( e.target ).attr( "href" ) ] );
	}

	</script>
</body>
</html>